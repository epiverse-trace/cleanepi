---
title: "cleanepi"
output: 
  rmarkdown::html_vignette:
    df_print: "kable"
vignette: >
  %\VignetteIndexEntry{cleanepi}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE} 
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(cleanepi)
```

## Clean input data
After importing a dataset into R, use the `clean_data()` function to apply some checks on it. These involve:        

1. cleaning the column names     
2. replacing characters that represent missing data with `NA`   
3. removing empty rows and columns    
4. removing constant columns i.e. columns with the same value across all rows   
5. removing duplicated rows across all columns or some specific columns    
6. converting character columns into date if the column actually contains date values at a specific extent (default is 90% of the values are date)
7. detecting and removing rows where the subject IDs do not comply with the expected format       

The functions returns a list of 2 objects:    
1. the cleaned dataset.    
2. a list with the outputs from all the data cleaning steps. Note that only steps where the input dataset was modified will have a reported element in that list.    

A function to generate a report (ideally in a form of a HTML file or dashboard) will be defined later.      

```{r eval=FALSE}
# IMPORTING THE TEST DATASET
test_data <- data.table::fread(
  system.file("extdata", "test.txt", package = "cleanepi")
  )

# DEFINING THE DATA CLEANING PARAMETERS
params <- list(
  remove_duplicates = TRUE,
  duplicates_from = NULL,
  replace_missing = TRUE,
  na_comes_as = "-99",
  check_timeframe = TRUE,
  timeframe = as.Date(c("1973-05-29", "2023-05-29")),
  error_tolerance = 0.5,
  subject_id_col_name = "study_id",
  subject_id_format = "PS000P2",
  prefix = "PS",
  suffix = "P2",
  range = c(1, 100)
  )

# CLEAN THE INPUT DATA FRAME
res <- clean_data(
  data = test_data,
  params = params
)

cleaned_data <- res$data
cleaning_report <- res$report
```
