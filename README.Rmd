---
output: github_document
editor_options: 
  markdown: 
    wrap: 72
---

<!-- README.md is generated from README.Rmd. Please edit that file. -->

<!-- The code to render this README is stored in .github/workflows/render-readme.yaml -->

<!-- Variables marked with double curly braces will be transformed beforehand: -->

<!-- `packagename` is extracted from the DESCRIPTION file -->

<!-- `gh_repo` is extracted via a special environment variable in GitHub Actions -->

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# cleanepi: Clean and standardize epidemiological data <img src="man/figures/logo.png" align="right" width="130"/>

<!-- badges: start -->

[![License:
MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![R-CMD-check](https://github.com/epiverse-trace/cleanepi/actions/workflows/R-CMD-check.yaml/badge.svg)](https://github.com/epiverse-trace/cleanepi/actions/workflows/R-CMD-check.yaml)
[![Codecov test
coverage](https://codecov.io/gh/epiverse-trace/cleanepi/branch/main/graph/badge.svg)](https://app.codecov.io/gh/epiverse-trace/cleanepi?branch=main)
[![lifecycle-experimental](https://raw.githubusercontent.com/reconverse/reconverse.github.io/master/images/badge-experimental.svg)](https://www.reconverse.org/lifecycle.html#experimental)

<!-- badges: end -->

**{cleanepi}** is an R package to clean, curate, and standardize epidemiological data. 

**{cleanepi}**  performs several data cleaning tasks that an end-user would anticipate to be performed on a cluttered dataset. These include standard tasks such as: removing duplicated and empty rows and columns, removing columns with constant values, replacing missing value strings with `NA`, ensuring uniqueness of uniquely identified columns, converting `character` columns to `Date` under certain conditions, etc.    
**{cleanepi}** can also standardize column entries into specified formats, calculates age (in years, months, weeks, or days) from a given `Date` column and a reference date.   
**{cleanepi}** expects input data in  a form of  data frame-like structure (`data.frame`, `tibble`, etc) or a `linelist` object and returns a processed data of the same type. It also returns an object of type `list` that reports the outcomes from every cleaning task.  

**{cleanepi}** is developed by  the [Epiverse-TRACE](https://data.org/initiatives/epiverse/) team at the Medical Research Council The Gambia unit at the London School of Hygiene and Tropical Medicine (MRCG@LSHTM).


## Installation

The current development version of **{cleanepi}** can be installed from  [here](https://epiverse-trace.github.io/cleanepi).

```{r}
if (!require("pak")) install.packages("pak")
pak::pak("epiverse-trace/cleanepi")
library(cleanepi)
```

## Quick start

<<<<<<< HEAD
The main function in **{cleanepi}** is `clean_data(),` which internally makes call of almost all standard data cleaning functions, such as removal of empty and duplicated rows and columns, replacement of missing values, etc. However, each function can also be called independently to perform a specific  task. This mechanism is explained in details in the **vignette**. Below is typical example of how to use the `clean_data()` function. 

```{r eval=TRUE}
# READING IN THE TEST DATASET
test_data       <- readRDS(system.file("extdata", "test_df.RDS",
                                       package = "cleanepi"))
=======
## Description
| function name | description |    
| :-------------- | :---------- |   
| **clean_data** | cleaning of column names, detecting and removing empty rows and columns as well as constant columns and duplicated rows. It also replaces missing values by NA and automatically convert date columns |      
| **check_subject_ids** | check whether the IDs comply with the expected format |    
| **standardize_date** | convert date column into _%Y-%m-%d_ |     
| **calculate_age** | calculate age from date column. Returned age can be in either _years_, or _months_, or _weeks_, or _days_ or a combination of some of these|    
| **check_date_sequence** | check whether the sequence of event dates is correct |
| **find_duplicates** | detect and return duplicated rows from the input dataset |
| **remove_duplicates** | remove detected duplicated rows |
| **WIP** | work in progress |

The main function in **cleanepi** is `clean_data()`. It makes call of almost all the other exported functions, which can also be called independently to perform a specific cleaning task. 

Most functions **cleanepi** will return a list with 2 elements:   

1. the processed input data (could be modified or not).   
2. a report object returned as list. 

## GENERAL DATA CLEANING
The example below performs the following data cleaning operations on the input dataset based on the following criteria:  

1. removal of any duplicated line across all columns (`remove_duplicates = TRUE`; `target_columns = NULL`)
2. replacement of the missing character `-99` by `NA` (`replace_missing = TRUE`; `na_comes_as = "-99"`)
3. conversion of any `character` column into `Date` if the 50% or more of its values turn out to be dates. Dates not within the specified time frame will be considered as outliers and replaced by `NA` (`check_timeframe = TRUE`; `timeframe = as.Date(c("1973-05-29", "2023-05-29"))`; `error_tolerance = 0.5`)
4. Checking if the subject IDs comply with the expected format (`subject_id_col_name = "study_id"`; `subject_id_format = "PS000P2"`; `prefix = "PS"`; `suffix = "P2"`; `range = c(1, 100)`). This will detect and remove the rows where the format of the subject IDs are incorrect.
5. The other cleaning operations, mentioned above, will be automatically applied to the input dataset. 

```{r eval=TRUE}
# READING IN THE TEST DATASET
test_data <- readRDS(system.file("extdata", "test_df.rds", 
                                 package = "cleanepi"))

# VISUALISE THE INPUT DATASET
>>>>>>> e9d0a62 (general updates)
print(test_data)
```

```{r eval=TRUE}
# READING IN THE DATA DICTIONARY
# test_dictionary <- readRDS(system.file("extdata", "test_dictionary.RDS",
#                                        package = "cleanepi"))
test_dictionary <- data.frame(options = c("1", "2"),
                        values  = c("male", "female"),
                        grp = rep("sex", 2L),
                        orders = 1:2)
print(test_dictionary)
```

```{r eval=TRUE}
# DEFINING THE CLEANING PARAMETERS
params <- list(
<<<<<<< HEAD
  remove_duplicates   = TRUE,
  target_columns      = NULL, 
  replace_missing     = TRUE,
  na_comes_as         = "-99",
  check_timeframe     = TRUE,
  timeframe           = as.Date(c("1973-05-29", "2023-05-29")),
  error_tolerance     = 0.5,
=======
  remove_duplicates = TRUE,
  target_columns = NULL,
  replace_missing = TRUE,
  na_comes_as = "-99",
  check_timeframe = TRUE,
  timeframe = as.Date(c("1973-05-29", "2023-05-29")),
  error_tolerance = 0.5,
>>>>>>> e9d0a62 (general updates)
  subject_id_col_name = "study_id",
  subject_id_format   = "PS000P2",
  prefix              = "PS",
  suffix              = "P2",
  range               = c(1, 100),
  keep                = "date.of.admission",
  dictionary          = test_dictionary
)

# PERFORMING THE DATA CLEANING
res <- clean_data(
  data   = test_data,
  params = params
)

cleaned_data    <- res$data
cleaning_report <- res$report

# VISUALISE THE CLEANED DATASET
print(cleaned_data)
```

## Vignette
```{r eval=FALSE}
browseVignettes("cleanepi")
```

## Next steps

:white_check_mark: write test scripts    
:white_check_mark: build function to display the cleaning report    
:white_check_mark: improve package coverage    


### Lifecycle

This package is currently an *experimental*, as defined by the [RECON software
lifecycle](https://www.reconverse.org/lifecycle.html). This means that it is
functional, but interfaces and functionalities may change over time, testing and documentation may be lacking.

### Contributions

Contributions are welcome via [pull
requests](https://github.com/%7B%7B%20gh_repo%20%7D%7D/pulls).

### Code of Conduct

Please note that the cleanepi project is released with a [Contributor
Code of
Conduct](https://github.com/epiverse-trace/.github/blob/main/CODE_OF_CONDUCT.md).
By contributing to this project, you agree to abide by its terms.
